#include    "..\common\common.h"
#include    "video.h"

#if defined(__AHD_TX__)

/**************************** 1280X720X30P , 16bit @ 74.25Mhz**************************/
static ROMDATA BYTE AHD_1280X720_30P_16B_74[] =  
{
 // 	 0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/	 0xA0,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/	 0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/	 0x02,0x00,0x00,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/**************************** 1280X720X25P , 16bit @ 74.25Mhz**************************/
static ROMDATA BYTE AHD_1280X720_25P_16B_74[] = 
{
 // 	 0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/	 0xA1,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/	 0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/	 0x03,0x00,0x00,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/**************************** 1280X720X30P , 16bit @ 37.125Mhz**************************/
static ROMDATA BYTE AHD_1280X720_30P_16B_37[] = {
 //      0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/   0xA0,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/   0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/   0x02,0x00,0x00,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/**************************** 1280X720X25P , 16bit @ 37.125Mhz**************************/
static ROMDATA BYTE AHD_1280X720_25P_16B_37[] = {
 //      0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/   0xA1,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/   0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/   0x03,0x00,0x00,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/**************************** 1280X720X30P , 8bit @ 74.25Mhz**************************/
static ROMDATA BYTE AHD_1280X720_30P_8B_74[] = {
 //      0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/   0xA0,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/   0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/   0x02,0x00,0x10,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/**************************** 1280X720X25P , 8bit @ 74.25Mhz**************************/
static ROMDATA BYTE AHD_1280X720_25P_8B_74[] = {
 //      0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0A 0x0B 0x0C 0x0D 0x0E 0x0F
 /*0*/   0xA1,0x00,0x00,0x80,0x80,0x08,0x00,0x08,0x7E,0x00,0x00,0x80,0x80,0x80,0x01,0x40,
 /*1*/   0x00,0x01,0x80,0x01,0x86,0x13,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*2*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*3*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*4*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*5*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*6*/   0x03,0x00,0x10,0x00,0x0A,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 /*7*/   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

void NVP6011_PLLInit(PNCDEC_INFO pINFO)
{
	AHD_RegWrite(0xFF,BANK1);

	if(pINFO->tx.enc_inputclk == ENC_CLK_74M)
		AHD_RegWrite(0x4A,0x1F);  //PLL value
	else if(pINFO->tx.enc_inputclk == ENC_CLK_37M)
		AHD_RegWrite(0x4A,0x0F);  //PLL value
	else
		AHD_RegWrite(0x4A,0x1F);  //PLL value
			
	AHD_RegWrite(0x4B,0x3A);  //PLL value
	AHD_RegWrite(0x48,0x61);  //PLL value update
	AHD_RegWrite(0x48,0x60);  //PLL value locking

	if(pINFO->tx.enc_input_bus == ENC_INBUS_16B)	AHD_RegWrite(0x46,0x05);  
	else											AHD_RegWrite(0x46,0x07);
	
	AHD_RegWrite(0x4E,0x01);

	AHD_RegWrite(0x4F,0x1B);
	AHD_RegWrite(0x51,0x00);
	AHD_RegWrite(0x52,0x67);
}


void NVP6011_CommonInit(PNCDEC_INFO pINFO)
{
	//DAC init
	AHD_RegWrite(0xFF,BANK0);
	AHD_RegWrite(0x02,0x2F);

	//PLL & CLKCO
	NVP6011_PLLInit(pINFO);

	AHD_RegWrite(0xFF,BANK6);
	if(pINFO->vformat == NTSC)
	{
		if(pINFO->tx.enc_input_bus == ENC_INBUS_16B)
		{
			if(pINFO->tx.enc_inputclk == ENC_CLK_37M)
			{
				AHD_MultiWrite(0x0, AHD_1280X720_30P_16B_74,128);
			}
			else
			{
				AHD_MultiWrite(0x0, AHD_1280X720_30P_16B_37,128);
			}
		}
		else
		{
			if(pINFO->tx.enc_inputclk == ENC_CLK_37M)
			{
			
			}
			else
			{
				AHD_MultiWrite(0x0, AHD_1280X720_30P_8B_74,128);
			}
		}
	}
	else
	{
		if(pINFO->tx.enc_input_bus == ENC_INBUS_16B)
		{
			if(pINFO->tx.enc_inputclk == ENC_CLK_37M)
			{
				AHD_MultiWrite(0x0, AHD_1280X720_25P_16B_37,128);
			}
			else
			{
				AHD_MultiWrite(0x0, AHD_1280X720_25P_16B_74,128);
			}
		}
		else
		{
			if(pINFO->tx.enc_inputclk == ENC_CLK_37M)
			{
			}
			else
			{
				AHD_MultiWrite(0x0, AHD_1280X720_25P_8B_74,128);
			}
		}
	}
	AHD_RegWrite(0xFF,BANK1);
	AHD_RegWrite(0x4F,0xFB);  
}


void PO3100K_Init(void)
{
	AHD_RegWrite(0xFF,BANK1);
	AHD_RegWrite(0x48,0x60);
	AHD_RegWrite(0x4A,0x2F);
	AHD_RegWrite(0x4B,0x74);
	AHD_RegWrite(0x48,0x61);
	AHD_RegWrite(0x48,0x60);
	AHD_RegWrite(0xFF,BANK1);
	AHD_RegWrite(0x46,0x0F);
	AHD_RegWrite(0x52,0x67);


	AHD_RegWrite(0xFF,BANK6);
	AHD_RegWrite(0x00,0xA0);
	AHD_RegWrite(0x60,0x02);
	AHD_RegWrite(0x64,0x0A);
	AHD_RegWrite(0x65,0x01);
	AHD_RegWrite(0x66,0x01);
	AHD_RegWrite(0x62,0x10);

}

void DecoderInitial(PNCDEC_INFO pINFO)
{
	VDEC_RST(HIGH);
	MDINDLY_mSec(20);
	VDEC_RST(LOW);
	MDINDLY_mSec(2000);
	VDEC_RST(HIGH);
	MDINDLY_mSec(20);

	printf("\r\nAHD TX Initialing...");
	NVP6011_CommonInit(pINFO);
	printf("OK\r\n");

//	PO3100K_Init();
}
#endif
